CREATE TABLE H(
	HACKER_ID INT,
	NAME VARCHAR(10)
);

INSERT INTO H
VALUES (5580,'ROSE'),
		(8439,'ANGELA'),
		(27205,'FRANK'),
		(52243,'PATRICK'),
		(52348,'LISA'),
		(57645,'KIMBERLY'),
		(77726,'BONNIE'),
		(83082,'MICHAEL'),
		(86870,'TODD'),
		(90411,'JOE');
	
SELECT * FROM H;

CREATE TABLE D(
	DIFFICULTY_LEVEL INT PRIMARY KEY AUTO_INCREMENT,
	SCORE INT
);

INSERT INTO D(SCORE)
VALUES (20),(30),(40),(60),(80),(100),(120);

SELECT * FROM D;

CREATE TABLE C(
	CHALLENGE_ID INT,
	HACKER_ID INT,
	DIFFICULTY_LEVEL INT
);

INSERT INTO C
VALUES (4810,77726,4),
		(21089,27205,1),
		(36566,5580,7),
		(66730,52243,6),
		(71055,52243,2);

SELECT * FROM C;	
	
CREATE TABLE S(
	SUBMISSION_ID INT,
	HACKER_ID INT,
	CHALLENGE_ID INT,
	SCORE INT
);
	
INSERT INTO S
VALUES (68628,77726,36566,30),
		(65300,77726,21089,10),
		(40326,52243,36566,77),
		(8941,27205,4810,4),
		(83554,77726,66730,30),
		(43353,52243,66730,0),
		(55385,52348,71055,20),
		(39784,27205,71055,23),
		(94613,86870,71055,30),
		(45788,52348,36566,0),
		(93058,86870,36566,30),
		(7344,8439,66730,92),
		(2721,8439,4810,36),
		(523,5580,71055,4),
		(49105,52348,66730,0),
		(55877,57645,66730,80),
		(38355,27205,66730,35),
		(3924,8439,36566,80),
		(97397,90411,66730,100),
		(84162,83082,4810,40),
		(97431,90411,71055,30);
	
SELECT * FROM S;	

WITH 
	A AS ( 
		SELECT CHALLENGE_ID, SCORE 
		FROM C JOIN D 
			ON D.DIFFICULTY_LEVEL = C.DIFFICULTY_LEVEL
		),
	B AS (
		SELECT HACKER_ID, S.SCORE
		FROM S JOIN A
			ON S.CHALLENGE_ID = A.CHALLENGE_ID 
				AND S.SCORE = A.SCORE
		)
SELECT H.HACKER_ID, NAME, COUNT(*) OVER(PARTITION BY H.HACKER_ID) AS R FROM H JOIN B ON H.HACKER_ID = B.HACKER_ID
ORDER BY HACKER_ID DESC;

	
	
	